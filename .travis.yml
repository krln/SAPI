language: ruby
bundler_args: --without development production staging
rvm:
  - 1.9.3
# uncomment this line if your project needs to run something other than `rake`:
before_script:
  - psql -c 'create database sapi_test' -U postgres
  - RAILS_ENV=test bundle exec rake db:migrate

env:
  - PGVERSION=9.3
before_install:
  - wget https://gist.github.com/petere/5893799/raw/apt.postgresql.org.sh
  - wget https://gist.github.com/C-Pro/8491912/raw/pg-pgtap-install.sh
  - wget https://gist.github.com/C-Pro/8492131/raw/install.cfg
  - sudo sh ./apt.postgresql.org.sh
  - sudo bash -c 'echo yes | cpan TAP::Parser::SourceHandler::pgTAP'
  - bash pg-pgtap-install.sh
install:
  - echo 'test' | bash ./install.sh
  - cat install.log
script:
  - export PERL5LIB=~/perl5/lib/perl5
  - cd test && ~/perl5/bin/pg_prove -h localhost -p 55436 -d sapi_test -U postgres spec/pgtap/*.sql
